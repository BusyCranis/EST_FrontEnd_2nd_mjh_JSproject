<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>
      <div style="display: flex">
        <div>구매회원가입</div>
        <div>판매회원가입</div>
      </div>
      아이디
      <input
        id="checkAccountDup"
        type="text"
        onchange="checkNameValidDupOnInput()"
      />
      <button onclick="checkAccountNameDup()">중복확인</button>
      <br />
      <div id="accountNameBase"></div>
      비밀번호
      <input id="pwinput" type="text" onchange="validatePasswordOnInput()" />
      <br />
      <div id="pwValidMessage"></div>
      비밀번호 재확인
      <input id="checkpwinput" type="text" /><br />
      이름
      <input id="username" type="text" /><br />
      휴대폰 번호
      <select id="phoneFirst">
        <option value="010">010</option>
      </select>
      <input id="midphone" type="text" />
      <input id="lastphone" type="text" />
      <br />
      <input id="agreeUseTerm" type="checkbox" />
      호두샵의 이용약관 및 개인정보처리방침에 대한 내용을 확인하였고 동의합니다.
      <br />
      <button onclick="requestSignup()">가입하기</button>
    </div>

    <script>
      let checkAccountDup = document.getElementById("checkAccountDup");
      let phoneFirst = document.getElementById("phoneFirst");
      var hasCheckedDuplicate = false;
      let accountNameBase = document.getElementById("accountNameBase");
      let pwinput = document.getElementById("pwinput");
      let pwValidMessage = document.getElementById("pwValidMessage");

      function checkAccountNameDup() {
        console.log(checkAccountDup.value);
        if (checkAccountDup.value && checkAccountDup.value !== "") {
          if (checkAccountDup.value.length < 20) {
            fetch(
              "https://estapi.openmarket.weniv.co.kr/accounts/validate-username/",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  username: checkAccountDup.value,
                }),
              }
            )
              .then((response) => response.json())
              .then((json) => {
                console.log(json);
                if (json.message) {
                  hasCheckedDuplicate = true;
                  accountNameBase.textContent = "멋진 아이디네요 :)";
                } else if (json.error) {
                  hasCheckedDuplicate = false;
                  accountNameBase.textContent = "이미 사용중인 아이디입니다.";
                }
              })
              .catch((error) => console.error(error));
          }
        }
      }

      function checkNameValidDupOnInput() {
        console.log(checkAccountDup.value.length);
        if (hasCheckedDuplicate === true) {
          hasCheckedDuplicate = false;
        }
        if (
          checkAccountDup.value &&
          checkAccountDup.value !== "" &&
          checkAccountDup.value.length < 20
        ) {
          accountNameBase.textContent = "";
        } else if (checkAccountDup.value.length >= 20) {
          accountNameBase.textContent =
            "20자 이내의 영문 소문자, 대문자, 숫자만 사용 가능합니다.";
        } else {
          accountNameBase.textContent = "필수 정보입니다.";
        }
      }

      function validatePasswordOnInput() {
        console.log(pwinput.value);
        if (pwinput.value.length < 8) {
          pwValidMessage.textContent = "";
        }
      }

      function requestSignup() {
        console.log(phoneFirst);
        console.log(phoneFirst.value);
        console.log(typeof phoneFirst.value);
      }
    </script>
  </body>
</html>
